{% extends "base.html" %}

{% block add %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
<style>
  /* Your CSS styles here */
</style>

<div class="container">
  <form id="incomeForm">
    <div class="form-group">
      <label for="incomeInput">Enter your income:</label>
      <input type="number" class="form-control" id="incomeInput" placeholder="Enter income" min="0">
    </div>
    <button type="submit">Next</button>
  </form>

  <div id="budgetFormContainer" style="display: none;">
    <form id="budgetForm">
      <div class="form-group">
        <label for="formControlRange">Set budget:</label>
        <input type="range" class="form-control-range" id="formControlRange" min="0" max="100">
        <span id="rangeValue">50</span>
      </div>
      <div class="form-group">
        <label for="dateRange">Select budget duration:</label>
        <input type="text" class="form-control" id="dateRange">
      </div>
      <button type="submit" class="btn btn-primary">Submit</button>
    </form>
  </div>

  <div id="budgetDisplay" style="display: none;">
    <p id="budgetDisplayText"></p>
  </div>

  <div class="col-md-6">
    <h4>Budget Summary:</h4>
    <table class="table">
      <thead>
        <tr>
          <th>Income</th>
          <th>Budget amount</th>
          <th>Date range</th>
        </tr>
      </thead>
      <tbody id="budgetTableBody">
        <!-- Budget data will be dynamically added here -->
      </tbody>
    </table>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
<script>
  var incomeValue = 0;
  var budgetValue = 0;
  var dateRangeValue = "";

  document.getElementById('incomeForm').addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent form submission
    incomeValue = parseFloat(document.getElementById('incomeInput').value);
    document.getElementById('incomeForm').style.display = 'none'; // Hide income form
    document.getElementById('budgetFormContainer').style.display = 'block'; // Show budget form
    document.getElementById('formControlRange').setAttribute('max', incomeValue); // Set max range based on income
  });

  $('#dateRange').datepicker({
    format: "yyyy-mm-dd",
    multidate: true,
    multidateSeparator: ", ",
    weekStart: 1 // Monday
  }).on('changeDate', function(event) {
    var dates = event.dates;
    if (dates.length === 1) {
      dateRangeValue = dates[0].toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
    } else if (dates.length > 1) {
      // If more than one date is selected, assume it's a week
      var startDate = dates[0];
      var endDate = dates[dates.length - 1];
      dateRangeValue = startDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) + " - " +
                      endDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    }
  });

  document.getElementById('budgetForm').addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent form submission
    budgetValue = parseFloat(document.getElementById('formControlRange').value);
    document.getElementById('budgetDisplayText').textContent = "Budget set to Rs." + budgetValue + " for " + dateRangeValue;
    document.getElementById('budgetDisplay').style.display = 'block'; // Show budget display

    // Add budget data to the table
    var budgetTableRow = "<tr><td>" + incomeValue + "</td><td>Rs." + budgetValue + "</td><td>" + dateRangeValue + "</td></tr>";
    document.getElementById('budgetTableBody').innerHTML = budgetTableRow;

    // Clear input fields
    document.getElementById('incomeInput').value = '';
    document.getElementById('formControlRange').value = '';
    $('#dateRange').val('');
  });

  // Update range value display
  document.getElementById('formControlRange').addEventListener('input', function() {
    document.getElementById('rangeValue').textContent = this.value;
  });
</script>
{% endblock %}
